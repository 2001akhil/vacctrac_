<!DOCTYPE html>
<html>

<head>
      <title>QR Code Reader</title>
      <script src="https://unpkg.com/@zxing/library@latest"></script>
</head>

<body>
      <video id="video" width="320" height="240" autoplay></video>
      <canvas id="canvas" style="display: none;"></canvas>
      <div id="result"></div>
      <script>
            const video = document.querySelector('#video');
            const canvas = document.querySelector('#canvas');
            const result = document.querySelector('#result');
            const codeReader = new ZXing.BrowserQRCodeReader();
            let stream;

            navigator.mediaDevices.getUserMedia({ video: true })
                  .then((mediaStream) => {
                        video.srcObject = mediaStream;
                        stream = mediaStream;
                  })
                  .catch((error) => {
                        console.error('Error accessing user media', error);
                  });

            const decode = () => {
                  canvas.width = video.videoWidth;
                  canvas.height = video.videoHeight;
                  canvas.getContext('2d').drawImage(video, 0, 0);
                  codeReader.decodeFromCanvas(canvas, (result, error) => {
                        if (result) {
                              console.log('QR code detected:', result.text);
                              alert(result.text);
                              video.pause();

                              stream.getTracks().forEach((track) => {
                                    track.stop();
                              });
                        } else if (error) {
                              console.error('Error decoding QR code', error);
                        }
                  });
            };

            video.addEventListener('loadedmetadata', () => {
                  setInterval(decode, 100);
            });
      </script>
</body>

</html>